"use strict";var adn=adn||{};adn.calls=adn.calls||[];try{!function(P,T,E){var c="ADN_DEV_SCRIPT",n=!!(T.getElementById(c)||{}).src;if(P.out&&!n)return P.out.devOutput("adn.out is already defined","initial check");var h,e,C,i,x={env:{localhost:{id:"localhost",as:"localhost:8078"},dev:{id:"dev",as:"adserver.dev.adnuntius.com",dt:"dev.data.adnuntius.com"},staging:{id:"staging",as:"adserver.staging.adnuntius.com",dt:"staging.data.adnuntius.com"},production:{id:"production",as:"delivery.adnuntius.com",dt:"data.adnuntius.com"}},sync:{PLATFORM_161:"https://ads.creative-serving.com/cm?redir=https%3A%2F%2Fdata.adnuntius.com%2Fsync%3FbrowserId%3D{BROWSER_ID}%26folderId%3D{FOLDER_ID}%26externalSystemType%3DP161%26externalSystemUserId%3D%24%7BUUID%7D"},methodEnums:{ifr:"ifr",composed:"composed",preview:"preview"},loadEnums:{lazy:"lazy",lazyRequest:"lazyRequest"},requestMode:{hasTarget:"hasTarget",default:"default"},postMessageType:{toParentImpression:"toParentImpression",toParentPageLoad:"toParentPageLoad",toParentResize:"toParentResize",toParentUpdateAd:"toParentUpdateAd",toParentSubscribe:"toParentSubscribe",toParentGetAdUnitInfo:"toParentGetAdUnitInfo",toParentAllChildrenViewed:"toParentAllChildrenViewed",toParentAdVisibilityEvent:"toParentAdVisibilityEvent",toParentCustomEvent:"toParentCustomEvent",toParentIsolateAdVisibilityEvent:"toParentIsolateAdVisibilityEvent",toChildViewability:"toChildViewability",toChildPubs:"toChildPubs",toChildAdUnitInfo:"toChildAdUnitInfo"},composedRequest:{noRequest:"noRequest",requestMade:"requestMade",requestReturned:"requestReturned"},container:{iframe:"iframe",div:"div"},feedback:{console:{all:"all",warnings:"warnings",errors:"errors",silent:"silent"},inScreen:{inAdUnit:"inAdUnit",silent:"silent"}},cwClass:"contentWrapperPerItem",widgetIdPrefix:"adn-widget-",adIdPrefix:"adn-id-",longestTime:9e5,defaultProximity:200,defaultVisibilityPercentage:1,postMessageSrcKey:"messageSrc",postMessageSrcValue:"adn",functionContext:{parent:"parent",inIframe:"inIframe"},viewabilityStatus:{notViewed:"notViewed",divMissing:"divMissing",blocked:"blocked",viewed:"viewed",viewSent:"viewSent"},visibilityStatus:{notVisible:"notVisible",visible:"visible",visibleSent:"visibleSent"},displayStatus:{notDisplayed:"notDisplayed",displayed:"displayed"},adStatus:{init:"init",processed:"processed",procured:"procured",distributed:"distributed"},scriptOverride:{github:{id:"github",url:"https://adnuntius.github.io/examples/adn/adn.dev.src.js"}},errorStatus:{noTarget:"noTarget"},previewId:"appPreviewId"},o=!0,u=!0,O={},l={},f={},y={},k={},b={},g=!1,s={userId:null,sessionId:null},p="data-parent-top",m="data-env",d="data-adn-console",v="adn-data-div-",a="adn.metaData",t="adn.data",I="adn.consent",w={PROFILE:"PROFILE",COUNTS:"COUNTS",EXTERNAL:"EXTERNAL",TARGETING:"TARGETING"},S={console:x.feedback.console.warnings,inScreen:x.feedback.inScreen.silent},A=x.composedRequest.noRequest;P.util={dimension:function(e){if(P.util.isString(e)){var t=P.util.trim(e);return 0===t.length||P.util.endsWith(t,"%")||P.util.endsWith(t,"px")?t:t+"px"}return P.util.isNumber(e)?e+"px":e},isLoopable:function(e){if(P.util.isArray(e))return!0;var t=Object.prototype.toString.call(e);return"[object HTMLCollection]"===t||"[object NodeList]"===t},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"object"==typeof e&&null!==e&&!P.util.isArray(e)},isInteger:function(e){return parseInt(e,10)===e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isString:function(e){return"string"==typeof e},isDefined:function(e){return null!=e},isNotBlankString:function(e){return P.util.isString(e)&&0<P.util.trim(e).length},isBlankString:function(e){return P.util.isString(e)&&0===P.util.trim(e).length},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},noop:function(){},isTopWindow:function(){return E.top===E.self||"localhost:9876"===E.location.host},trim:function(e){return P.util.isString(e)?String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},getFrameElement:function(){try{return E.frameElement}catch(e){P.out.devOutput("Error looking up frame element")}},endsWith:function(e,t){return P.util.isNotBlankString(e)&&P.util.isNotBlankString(t)&&e.substr(e.length-t.length,t.length)===t},createDelegate:function(e,t){if(!P.util.isObject(e)&&null!==e||!P.util.isFunction(t))return P.out.output("Args not sufficient","createDelegate",e,t);var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,0<i.length?Array.prototype.slice.call(arguments,0).concat(i):arguments)}},detachEventListener:function(e,t,i){return P.util.isObject(e)&&t?P.util.isFunction(e.removeEventListener)?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):P.out.output("Object to attach event listeners is not sufficient","detachEventListener",e,t):P.out.output("Args not sufficient","detachEventListener",e,t)},addEventListener:function(e,t,i){return P.util.isObject(e)&&t?P.util.isFunction(e.addEventListener)?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):P.out.output("Object to attach event listeners is not sufficient","addEventListener",e,t,i):P.out.output("Args not sufficient","addEventListener",e,t,i)},getWindowDims:function(){var e=P.util.getWindowSize();return{w:e.width,h:e.height}},getWindowSize:function(){var e={width:0,height:0};return P.util.isNumber(E.innerWidth)?(e.width=E.innerWidth,e.height=E.innerHeight):T.documentElement&&(T.documentElement.clientWidth||T.documentElement.clientHeight)?(e.width=T.documentElement.clientWidth,e.height=T.documentElement.clientHeight):T.body&&(T.body.clientWidth||T.body.clientHeight)&&(e.width=T.body.clientWidth,e.height=T.body.clientHeight),e},getScrollPos:function(){var e={left:0,top:0};return P.util.isNumber(E.pageYOffset)?(e.top=E.pageYOffset,e.left=E.pageXOffset):T.body&&(T.body.scrollLeft||T.body.scrollTop)?(e.top=T.body.scrollTop,e.left=T.body.scrollLeft):T.documentElement&&(T.documentElement.scrollLeft||T.documentElement.scrollTop)&&(e.top=T.documentElement.scrollTop,e.left=T.documentElement.scrollLeft),e},getElementPosition:function(e){var t={left:0,top:0};if(e.offsetParent)for(;t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;);return t},getNewAjax:function(e,t,i){if(P.util.isDefined(E.XDomainRequest)&&-1===E.navigator.appVersion.indexOf("MSIE 10")){var n=new E.XDomainRequest;return n.open(e,t),n.contentType="text/plain",n.onerror=P.util.noop,n.ontimeout=P.util.noop,n.onprogress=P.util.noop,n.timeout=P.util.noop,n.onload=P.util.noop,P.util.isFunction(i)&&(n.onload=i),n}var r=new XMLHttpRequest;return r.open(e,t),r.setRequestHeader("Content-Type","text/plain"),P.util.isFunction(i)&&(r.onreadystatechange=i),r},hasValue:function(e,t){var i=!1;return P.util.forEach(e,function(e){if(e===t)return!(i=!0)}),i},find:function(i,n){if(!P.util.isFunction(n)||!P.util.isObject(i)&&!P.util.isLoopable(i)||!P.util.isDefined(i))return P.out.output("Args not sufficient","find",i,n);var r=null;return P.util.forEach(i,function(e,t){if(!0===n.call(i,e,t))return r=e,!1}),r},map:function(i,n){if(!P.util.isFunction(n)||P.util.isString(i)||!P.util.isDefined(i))return P.out.output("Args not sufficient","filter");var r=[];return P.util.forEach(i,function(e,t){r.push(n.call(i,e,t))}),r},filter:function(i,n){if(!P.util.isFunction(n)||P.util.isString(i)||!P.util.isDefined(i))return P.out.output("Args not sufficient","filter");var r=[];return P.util.forEach(i,function(e,t){!0===n.call(i,e,t)&&r.push(e)}),r},forEach:function(e,t){if(!P.util.isFunction(t)||!P.util.isObject(e)&&!P.util.isLoopable(e)||!P.util.isDefined(e))return P.out.output("Args not sufficient","forEach");var i;if(P.util.isLoopable(e)){for(var n=e.length,r=[],s=0;s<n;s++)r.push(e[s]);for(s=0;s<n;s++)if(i=r[s],!1===t.call(r,i,s))return i}else for(var a in e)if(e.hasOwnProperty(a)&&(i=e[a],!1===t.call(e,i,a)))return i},loadScriptElements:function(e,r){var t=e.getElementsByTagName("script");P.util.forEach(t,function(e){if(e)if(P.util.isNotBlankString(e.type)&&"text/javascript"!==e.type)P.out.devOutput("Not executing script type","showAdContent",e.type,e);else{var t={};if(P.util.forEach(e.attributes,function(e){e.specified&&(t[e.name]=e.value)}),e.src){var i=e.src;e.parentNode.removeChild(e),C.loadScriptSrc(i,r,t)}else{var n=e.innerHTML;e.parentNode.removeChild(e),C.loadScriptContent(n,r,t)}}})},hasProperties:function(e){if(!P.util.isObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},getElementDimensions:function(e){try{var t=e.getBoundingClientRect();return{w:t.width||t.right-t.left,h:t.height||t.top-t.bottom}}catch(e){return P.out.output("element dimensions failed","getElementDimensions: catch block",e)}},isTrue:function(e){return!0===e||"true"===e}},function(){P.out={devOutput:function(e,t){return!(!g&&S.console!==x.feedback.console.all)&&P.out.output(e,t,Array.prototype.slice.call(arguments,2))},output:function(e,t){if(S.console!==x.feedback.console.silent){var i=Array.prototype.slice.call(arguments,2),n=P.util.filter(i,function(e){return P.util.isFunction(e)}),r=P.util.filter(i,function(e){return!P.util.isFunction(e)}),s=function(e,t,i){e(t,i),P.util.forEach(n,function(e){e({context:t,message:i,args:r})})},a=function(i){r&&r.length&&P.util.forEach(r,function(e,t){P.util.isFunction(e)?n.push(e):i("Arg #"+t,e)})};return E.console&&E.console.warn&&E.console.error&&E.console.log&&(P.util.isObject(e)&&0<=e.lineNumber?s(E.console.error,"At "+t+":",e):s(E.console.warn,"At "+t+":",e),a(E.console.log)),!1}},warn:function(e){S.console!==x.feedback.console.all&&S.console!==x.feedback.console.warnings||E.console&&E.console.warn&&E.console.warn(e)}};var r=function(e,t){var i,n,r=e.env||x.env.production.id;i=x.env[r]?x.env[r]:x.env.production;var s="http"+(C.isTestAddress(E.location.href)||r===x.env.localhost.id||"http:"===E.location.protocol?"":"s");n=("https"===e.protocol||"http"===e.protocol?e.protocol:s)+"://";var a=C.isTestAddress(r),o=(g=a||g)&&0===(r||"").indexOf("http")?r:n+i[t||"as"];return{serverUrlBase:o,baseRequestLoc:o+(a?"?":"/i?")+"tzo="+(new Date).getTimezoneOffset(),isTestEnv:a}};P.lib={setDevMode:function(e){g=!0===e},testingHook:function(e){0===E.location.origin.indexOf("http://localhost")&&(O={},y={},f={},e.adn=P,e.CONSTANTS=x,e.ev=j,e.dom=F,e.readings=W,e.misc=C,e.gComposedAds=y,e.gWidgetSpecs=O,e.gAdSpecs=f,e.gAdLocs=l,e.gDevMode=g,e.gUserIds=s,e.storageMetadataKey=a,e.cookies=V,e.parentMethods=z,e.pFrameMethods=B,e.requestMethods=h)},isParentTopWindow:function(){var e=P.inIframe.getIframeArgs()[p];if(P.util.isTrue(e))return!0;var t=T.getElementsByTagName("body")[0];if(t&&t.hasAttribute(p))return P.util.isTrue(t.getAttribute(p));var i=P.util.getFrameElement();return!!P.util.isDefined(i)&&P.util.isTrue(i.getAttribute(p))},getEnv:function(){var e=P.inIframe.getIframeArgs()[m];if(P.util.isNotBlankString(e)&&x.env[e])return x.env[e].id;var t=T.getElementsByTagName("body")[0];return e=t?t.getAttribute(m):"",P.util.isNotBlankString(e)&&x.env[e]?x.env[e].id:x.env.production.id},getAdnDataLocs:function(e){var t=C.clone(e||{});t.protocol="https";var i=r(t,"dt"),n={};return C.copyArgValues(n,t,["browserId","folderId","sessionId","userId"]),{page:i.baseRequestLoc.replace("/i?","/page?")+C.encodeAsUrlParams(n,!0),visitor:i.baseRequestLoc.replace("/i?","/visitor?")+C.encodeAsUrlParams(n,!0),user:i.baseRequestLoc.replace("/i?","/usr?")+C.encodeAsUrlParams(n,!0),sync:i.baseRequestLoc.replace("/i?","/sync?")+C.encodeAsUrlParams(n,!0)}},getRequestLocs:function(e,t){var i=r(e),n={};return C.copyArgValues(n,e,["usi","siteId","latitude","longitude","segments"]),!1!==e.useCookies&&!1!==u||(n.noCookies=!0),!t||P.util.isTopWindow()||C.supportsIntersectionObserver()||(n.immeasurable=!0),{imp:i.baseRequestLoc+C.encodeAsUrlParams(n,!0),rendered:i.baseRequestLoc.replace("/i?","/b?"),viewable:i.baseRequestLoc.replace("/i?","/v?"),visible:i.baseRequestLoc.replace("/i?","/s?"),custom:i.baseRequestLoc.replace("/i?","/u?"),retargeting:i.baseRequestLoc.replace("/i?","/r?"),conversion:i.baseRequestLoc.replace("/i?","/conv?"),preview:i.serverUrlBase+(i.isTestEnv?"?":"/preview?")}},sendRenderedImps:function(e,t){if(!P.util.isArray(e))return P.out.devOutput("No tokens to speak of","sendRenderedImps",e,t);if(!(e.length<1)){if(!t||P.util.isBlankString(t))return P.out.devOutput("Missing a location","sendRenderedImps",e,t);var i=P.util.getNewAjax("POST",t,function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&P.util.isNotBlankString(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){return P.out.output(e,"ajax.onreadystatechange: catch block send event",t)}e&&e.metaData&&V.writeAdvLs(e.metaData)}}),n={rts:e};C.setAndReturnMetaData(n),i.send(JSON.stringify(n))}},doDebug:function(n,e,t){if(S.inScreen===x.feedback.inScreen.inAdUnit){var i=T.createElement("div");i.id=v+n.widgetId;var r="position: absolute;top: 0; left: 0; text-align: left;";r+="border: 1px solid red; background-color: pink; padding: 5px;z-index: 10000;opacity: 0.9;",r+="min-width: 250px;max-width: "+Math.max(e.width,350)+"px; max-height: 500px; overflow: auto",i.style.cssText=r,i.className="adnDebugDataDiv";var s=[];P.util.forEach(n.ads,function(e){s.push({adId:e.id,lineItemId:e.lineItemId,creativeId:e.creativeId,cost:e.cost?e.cost.amount+e.cost.currency:"n/a",bid:e.bid?e.bid.amount+e.bid.currency:"n/a"})});var a="<div style='min-height: 1em;height:auto;'>AU Tag id: <a target='_blank' href='https://admin.adnuntius.com/search?q="+n.auId+"'>"+n.auId+"</a></strong></div>";a+="<div style='padding-bottom: 2px; margin-bottom: 2px; border-bottom: 1px dashed #333;height:auto'><small>",P.util.forEach(n.requestArgs,function(e,t){if("adUnits"!==t)"userId"!==t&&"sessionId"!==t&&(a+=C.dataOutput(t,e));else{var i=P.util.find(e,function(e){return!(e.auId!==n.auId||e.targetId&&e.targetId!==n.targetId||e.targetClass&&e.targetClass!==n.targetClass)});i&&P.util.forEach(i,function(e,t){"auId"!==t&&(a+=C.dataOutput(t,e))})}});var o=V.getIdsAsObj(n);o.userId&&(a+=C.dataOutput("userId",o.userId)),o.sessionId&&(a+=C.dataOutput("sessionId",o.sessionId)),a+="</small></div>",0===s.length&&(a+="<div><strong>No ads returned for ad call</strong></div>"),P.util.forEach(s,function(e){a+="<div style='min-height: 1em;height: auto;'>LI: <a target='_blank' href='http://admin.adnuntius.com/line-items/line-item/"+e.lineItemId+"'>"+e.lineItemId+"</a> | Cr: <a target='_blank' href='http://admin.adnuntius.com/creatives/creative/"+e.creativeId+"'>"+e.creativeId+"</a> | cost: "+e.cost+" | bid: "+e.bid+"</div>"}),a+="<div style='height:auto;'><small>",P.util.forEach(["Segments","Keywords"],function(e){var t="returned"+e;n[t]&&0<n[t].length&&(a+=C.dataOutput(e.toLowerCase(),n[t]))}),a+="</small></div>",i.innerHTML=a,e.parentNode.insertBefore(i,e),t.style.border="2px solid red",t.style.position="relative"}},showAdContent:function(t,e){var i=C.getDocEl(t),n=y[t.targetId];if(!i)return n&&(n.errorStatus=x.errorStatus.noTarget),P.out.output("Unable to find HTML element","showAdContent",n,t),P.out.warn("Unable to find HTML element on page with the following id: "+t.targetId);n&&(n.errorStatus=""),P.util.isTrue(t.clearTarget)&&(i.innerHTML="");var r=e.html,s=e.matchedAdCount;if(t.container===x.container.div&&P.util.isNumber(s)){if(0<i.getElementsByTagName("div").length)return;return i.innerHTML=C.getAdContentOnly(r,t.widgetId),P.util.loadScriptElements(i,t.widgetId),F.showTargetDiv(i,t),P.lib.doDebug(t,T.getElementById(t.widgetId),i),!0}if(!P.util.find(i.childNodes,function(e){return e.id===t.widgetId})){var a=P.util.filter(i.childNodes,function(e){var t=e?e.id:"";return t&&0===t.indexOf(x.widgetIdPrefix)})||[];t.serverUrl=null;var o=F.insIframe(t,i),u=C.getScriptOverride();u&&(r=r.replace(/<script type="?text\/javascript"? src="?https?:\/\/[A-Za-z_0-9:.-]{5,50}\/adn.(src.)?js"?><\/script>/g,'<script type="text/javascript" src="'+u+'" id="'+c+'"><\/script>'));var d="<body id='"+t.widgetId+"' "+p+"='"+P.util.isTopWindow()+"'";if(t.env&&t.env!==x.env.production.id&&(d+=" "+m+"='"+t.env+"'"),r=r.replace("<body",d),C.supportsSrcDoc()&&t.isolateFrame)o.setAttribute("srcdoc",r);else{var l=o.contentDocument||o.contentWindow;l&&l.document&&(l=l.document),l||P.out.devOutput("Couldn't find iframeDoc","showAdContent",i,o,l),l.open(),l.write(r),l.close()}return P.util.forEach(a,function(e){e.style.display="none"}),P.lib.doDebug(t,o,i),!0}}}}(),C={uuid:function(){for(var e="",t=0;t<24;t++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},supportsSrcDoc:function(){return!!("srcdoc"in T.createElement("iframe"))},isSrcdocFrame:function(){return"about:srcdoc"===C.getLocationHref()||"null"===E.location.origin},getLocationHref:function(){return E.location.href},supportsIntersectionObserver:function(){return"IntersectionObserver"in E&&"IntersectionObserverEntry"in E&&"intersectionRatio"in E.IntersectionObserverEntry.prototype},getParam:function(e,t){if(P.util.isObject(e))return e[t]},loadScriptSrc:function(e,t,i){if(!P.util.isString(e))return P.out.output("src should be a string","loadScriptSrc",e);try{var n=T.createElement("script");n.type="text/javascript",P.util.forEach(i,function(e,t){n.setAttribute(t,e)}),n.src=e;var r=t?T.getElementById(t):null;if(r)r.appendChild(n);else{var s=T.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s)}}catch(e){return P.out.output(e,"loadScriptSrc: in catch block")}},addWidgetIdToProcessAd:function(e,t){var i="adn.inIframe.processAdResponse({",n=i+" widgetId: '"+t+"', ",r='adn.inIframe.getIframeId("'+t+'"';return e.replace(i,n).replace(/adn.inIframe.getIframeId\(/g,r)},loadScriptContent:function(e,t,i){if(!P.util.isString(e))return P.out.output("content should be a string","loadScriptContent",e);try{var n=T.createElement("script");n.type="text/javascript",P.util.forEach(i||{},function(e,t){n.setAttribute(t,e)});var r=T.createTextNode(e);n.appendChild(r),(T.getElementById(t)||T.body).appendChild(n)}catch(e){return P.out.output(e,"loadScriptContent: in catch block")}},applyStyle:function(i,e){return P.util.forEach(e,function(e,t){i.style[t]=e})},parseHashArgs:function(){var e,t;return C.decodeUrlEncodedPairs((e=E.location.href||"",-1<(t=e.indexOf("#"))?e.substr(t+1):""))},parseUrlArgs:function(){return C.decodeUrlEncodedPairs(E.location.search)},clone:function(e){var t=P.util.isObject(e)?{}:P.util.isArray(e)?[]:null;return t?C.assign(t,e):e},assign:function(i,e){return P.util.forEach(e,function(e,t){P.util.isObject(e)?(P.util.isObject(i[t])||(i[t]={}),C.assign(i[t],e)):P.util.isArray(e)?(P.util.isArray(i[t])||(i[t]=[]),function(e,t){for(var i=0;i<t.length;i++)e.push(C.clone(t[i]))}(i[t],e)):i[t]=e}),i},copyArgValues:function(i,e,n){return P.util.isArray(n)&&P.util.isObject(i)&&P.util.isObject(e)?(P.util.forEach(e,function(e,t){e&&P.util.hasValue(n,t)&&(i[t]=e)}),i):P.out.output("Args not sufficient","copyArgValues",i,e,n)},decodeUrlEncodedPairs:function(e){if(!P.util.isString(e))return P.out.output("urlEncodedPairs should be a string","decodeUrlEncodedPairs");for(var t={},i=e.replace(/\?/,"").replace(/#/,"").split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(2===r.length){var s=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);P.util.isDefined(t[s])?(P.util.isArray(t[s])||(t[s]=[t[s]]),t[s].push(a)):t[s]=a}}return t},combineArgs:function(){for(var e={},t=arguments.length,i=0;i<t;i++){var n=arguments[i];P.util.isObject(n)&&C.assign(e,arguments[i])}return e},getQueryParamsByName:function(e){if(!P.util.isString(e)||P.util.isBlankString(e))return null;var t=C.getLocationHref(),i=e.replace(/[[\]]/g,"\\$&"),n=new RegExp("[?&]"+i+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},encodeAsUrlParams:function(e,t){if(P.util.isString(e))return e;var n=[];if(P.util.forEach(e,function(e,t){var i=encodeURIComponent(t)+"=";P.util.isArray(e)?P.util.forEach(e,function(e){n.push(i+encodeURIComponent(P.util.isObject(e)?JSON.stringify(e):e))}):P.util.isObject(e)?n.push(i+encodeURIComponent(JSON.stringify(e))):P.util.isDefined(e)&&!P.util.isBlankString(e)&&n.push(i+encodeURIComponent(e))}),0===n.length)return"";var i=n.join("&");return t?"&"+i:i},isAdnPrice:function(e){return P.util.isObject(e)&&P.util.isNumber(e.amount)&&0<e.amount&&P.util.isString(e.currency)&&3===e.currency.length},postMessageToParent:function(e){return P.util.isObject(E.parent)&&E.parent.postMessage&&P.util.isObject(e)?e.isDivContainer?j.handlePostMessage(e):(e[x.postMessageSrcKey]=x.postMessageSrcValue,void E.parent.postMessage(JSON.stringify(e),"*")):P.out.output("Attributes not sufficient","postMessageToParent")},postMessageToChild:function(e,t){return P.util.isObject(t)?P.util.isTrue(t.isDivContainer)?j.handlePostMessage(t):e&&e.contentWindow?e.contentWindow.postMessage?(t[x.postMessageSrcKey]=x.postMessageSrcValue,void e.contentWindow.postMessage(JSON.stringify(t),e.src||"*")):P.out.output("Childframe doesn't support postMessage","postMessageToChild",e,t):P.out.output("Childframe isn't really a child frame","postMessageToChild",e,t):P.out.output("Expected an object for a message","postMessageToChild",t)},dataOutput:function(e,t){return e+": "+(P.util.isObject(t)||P.util.isArray(t)?JSON.stringify(t):t)+" | "},getUnixTimestamp:function(e){return Math.floor((new Date).getTime()/1e3)+(P.util.isNumber(e)?864e5*e:0)},getDocEl:function(e){if(e.targetClass){var t=T.getElementsByClassName(e.targetClass);return P.util.find(t,function(e){return!e.hasChildNodes()})||t[0]}if(e.duplicateId){var i=T.querySelectorAll("*[id='"+e.targetId+"']");return P.util.find(i,function(e){return!e.hasChildNodes()})||i[0]}return T.getElementById(e.targetId)},isTestAddress:function(e){return!!(P.util.isString(e)&&0===e.indexOf("http://localhost")&&0<e.indexOf("/test"))&&(g=!0)},getEnvFromHref:function(t){return P.util.forEach(x.env,function(e){return t.indexOf("://"+e.as)<1})},getAdContentOnly:function(e,t){var i="</body>",n=e.indexOf('<div id="adn-rsp-'),r=e.indexOf(i);if(!(n<1||r<1)){var s=e.substring(n,r);return s='<div id="'+t+'">'+s+"</div>",C.addWidgetIdToProcessAd(s,t)}P.out.output("Something unexpected has gone on with the content of the ad server response","getAdContentOnly",i,r,e)},gatherDataParams:function(e,t,i,n){var r=[],s={},a=P.util.isFunction(t)?t:function(){return!0},o=P.util.isFunction(i)?i:P.util.noop,u=n||{},d=["auId","creativeId","networkId","targetId","c","kv","replacements","ps","auml","floorPrice"],l=[{server:"userSegments",script:"userSegments"},{server:"context",script:"ctx"}];return P.util.forEach(e,function(t){if(!0===a(t)){var i={};P.util.forEach(d,function(e){i[e]=t[e]}),t.floorPrice&&!C.isAdnPrice(t.floorPrice)&&(P.out.output("Floor price is not valid","gatherDataParams",t),delete i.floorPrice),r.push(i),P.util.forEach(l,function(e){s[e.server]=s[e.server]||t[e.script]}),o(t)}}),P.util.forEach(d,function(e){delete u[e]}),P.util.forEach(l,function(e){delete u[e.server],delete u[e.script]}),{adUnits:r,params:s}},getScriptOverride:function(){if(P.util.isString(e))return e;var t=C.getQueryParamsByName("script-override");return e="",P.util.isString(t)&&0<t.length&&(e=(P.util.find(x.scriptOverride,function(e){return e.id===t})||{}).url||""),e},gatherExclusions:function(e){var t=function(e,t,i){P.util.isArray(t[i])&&0<t[i].length&&(e[i]=t[i])},i={};return P.util.isArray(e)?P.util.forEach(e,function(e){t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")}):(t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")),i},encodeUrlParams:function(e,t,i){var n=i||{};C.copyArgValues(t,n,["auml","ps","c"]),n.kv&&(t.kv=JSON.stringify(n.kv)),n.ctx&&(t.ctx=n.ctx),n.replacements&&(t.replacements=JSON.stringify(n.replacements)),n.userSegments&&(t.userSegments=JSON.stringify(n.userSegments)),C.isAdnPrice(n.floorPrice)?t.fp=JSON.stringify(n.floorPrice):n.floorPrice&&P.out.output("Not a valid floorprice supplied.","encodeUrlParams",n);try{return e+=C.encodeAsUrlParams(t,!0)}catch(e){return P.out.output("encoding urls failed","insIframe: catch block",e)}},setAndReturnMetaData:function(e){var t=e,i=V.getAllAdvStorageAsObj();return P.util.hasProperties(i)&&((t=t||{}).metaData=i),t},normalise:function(i){var n={auW:"auW",auH:"auH"};return P.util.forEach(i,function(e,t){n[t]&&(i[t]=e.toString())}),i}};var r,N,D,M,L,R,q,U=function(){var e=C.getQueryParamsByName("adnMeta");if(P.util.isNotBlankString(e)){var t,i=E.atob(e);try{t=JSON.parse(i)}catch(e){return P.out.output("JSON Parse string for adnMeta failed","regDestination",i)}V.writeAdvLs(t)}},j={handleChildPageLoad:function(e,t){var i=T.getElementById(P.inIframe.getResponseCtrId());if(!i)return P.out.devOutput("Can't find container ID","handleChildPageLoad",P.inIframe.getResponseCtrId());var n=P.util.getElementDimensions(i),r=P.inIframe.isResizeToContent(),s=t?x.postMessageType.toParentResize:x.postMessageType.toParentPageLoad,a=i.getElementsByTagName("iframe")[0];if(a){var o=P.util.getElementDimensions(a);o.w>n.w&&(n.w=o.w),o.h>n.h&&(n.h=o.h)}(n.w<1||n.h<1)&&!t&&(r=!1),C.postMessageToParent({widgetId:P.inIframe.getIframeId(),messageType:s,w:n.w,h:n.h,resizeToContent:r}),t||E.setTimeout(function(){j.handleChildPageLoad({},!0)},750)},handleChildSubs:function(e,t){var i=T.getElementById(t.widgetId);if(!i)return P.out.output("Cannot find widget","handleChildSubs",e,t);var n={messageType:x.postMessageType.toChildPubs,windowDims:P.util.getWindowDims(),widgetDims:P.util.getElementDimensions(i),widgetParentDims:P.util.getElementDimensions(i.parentElement),widgetId:t.widgetId,event:t.event,isDivContainer:t.isDivContainer};P.util.isDefined(t.functionCalls)&&(n.functionCalls=t.functionCalls),C.postMessageToChild(i,n)},handlePostMessage:function(t){if(!P.util.isObject(t))return P.out.output("Handle post aMessage is being used in weird ways","handlePostMessage",t);if(P.util.isString(t.data)||P.util.isTrue(t.isDivContainer)){var i={};if(P.util.isTrue(t.isDivContainer))i=C.clone(t);else{try{i=JSON.parse(t.data)}catch(e){return P.out.devOutput("Couldn't handle parsing","handlePostMessage",t.data,t)}if(i[x.postMessageSrcKey]!==x.postMessageSrcValue)return!1}var n=O[i.widgetId]||{};if(i.messageType===x.postMessageType.toChildPubs){if(!P.util.isString(i.event)||!P.util.isString(i.widgetId))return P.out.output("Requires more data","handlePostMessage",i);var e={widgetId:i.widgetId,event:i.event,windowDims:i.windowDims,widgetDims:i.widgetDims,widgetParentDims:i.widgetParentDims};P.util.isDefined(i.functionCalls)&&(e.functionCalls=i.functionCalls),B.handleChildPubs(e)}else if(i.messageType===x.postMessageType.toChildAdUnitInfo){if(!P.util.isString(i.adUnitInfoId))return P.out.output("Requires more data","handlePostMessage",i);B.handleAdUnitInfo(i)}else if(i.messageType===x.postMessageType.toParentGetAdUnitInfo){if(!P.util.isString(i.adUnitInfoId)||!P.util.hasProperties(n))return P.out.output("Needs ad unit info id and widget id","handlePostMessage",i,n);C.postMessageToChild(T.getElementById(i.widgetId),{adUnitInfoId:i.adUnitInfoId,messageType:x.postMessageType.toChildAdUnitInfo,adUnitInfo:n,isDivContainer:i.isDivContainer})}else if(i.messageType===x.postMessageType.toParentIsolateAdVisibilityEvent){if(!P.util.isString(i.impRequestLoc)||!P.util.isObject(i.spec)||!P.util.isString(i.feedbackText))return P.out.output("Missing required data to send isolate visibility event","handlePostMessage",i);W.sendEventFromParent(i.impRequestLoc,i.spec,i.feedbackText)}else if(i.messageType===x.postMessageType.toParentCustomEvent){if(!P.util.isDefined(i.args)||!P.util.isObject(i.customArgs)||!P.util.isObject(i.pAdSpec))return P.out.output("Missing required data to send custom event info","handlePostMessage",i);P.inIframe.sendCustomEvent(i.args,i.customArgs,i.pAdSpec)}else if(i.messageType===x.postMessageType.toParentAdVisibilityEvent){if(!P.util.hasProperties(n))return P.out.output("Need widget info","toParentAdViewable",i,n);P.util.isObject(n.refresh)&&i.callbackProp===n.refresh.event&&0<n.refresh.count&&E.setTimeout(function(){var e=n.parentArgs||{},t=C.clone(n.auArgs);t.refresh=C.clone(n.refresh),t.refresh.count--,e.adUnits=[t],P.request(e)},1e3*n.refresh.delay),n[i.callbackProp]&&P.util.isFunction(n[i.callbackProp])&&n[i.callbackProp]({widgetId:i.widgetId,auId:n.auId,adId:i.adId,creativeId:i.creativeId,viewability:i.viewability});var r=T.getElementById(v+n.widgetId);r&&i.debugMessage&&(r.innerHTML+="<div><small>"+i.debugMessage+" - "+i.creativeId+"</small></div>")}else if(i.messageType===x.postMessageType.toParentSubscribe){if(!P.util.isString(i.event)||!P.util.isString(i.widgetId))return P.out.output("Requires on event","handlePostMessage",i);P.util.addEventListener(E,i.event,P.util.createDelegate(j,j.handleChildSubs,{widgetId:i.widgetId,event:i.event,isDivContainer:i.isDivContainer}))}else if(i.messageType===x.postMessageType.toParentPageLoad||i.messageType===x.postMessageType.toParentResize){if(!1===n.resizeOnPageLoad||P.util.isFunction(n.resizeOnPageLoad)&&!1===n.resizeOnPageLoad(i)||P.util.isTrue(i.resizeToContent)&&z.iframeResizer({widgetId:n.widgetId,w:i.w,h:i.h},!1),i.messageType===x.postMessageType.toParentPageLoad&&P.util.isFunction(n.onPageLoad)){var s={};C.copyArgValues(s,n,["auId","widgetId","auW","auH","retAdsW","retAdsH","retAdCount","targetId","replacements","kv","userSegments","c","ps","auml","floorPrice","requestArgs"]),s.w=i.w,s.h=i.h,n.onPageLoad(C.normalise(s))}}else{if(!P.util.isString(i.method))return P.out.output("args should have a method to call","handlePostMessage");try{i.functionContext===x.functionContext.inIframe?P.util.isFunction(B[i.method])?B[i.method].call(P.inIframe,i):P.inIframe[i.method].call(P.inIframe,i):z[i.method].call(z,i)}catch(e){return P.out.output(e,"catch block for calling method",i,e)}if(i.messageType===x.postMessageType.toParentImpression){if(C.copyArgValues(n,i,["retAdsW","retAdsH","retAdCount"]),P.util.isFunction(n.onImpressionResponse)){var a={};C.copyArgValues(a,n,["auId","widgetId","auW","auH","retAdsW","retAdsH","retAdCount","replacements","targetId","kv","userSegments","c","ps","auml","floorPrice","requestArgs"]),n.onImpressionResponse(C.normalise(a))}j.handleChildSubs({},{event:"impRegistered",widgetId:i.widgetId,functionCalls:n.functionCalls,isDivContainer:i.isDivContainer})}}}},registerListeners:function(){P.util.addEventListener(E,"message",P.util.createDelegate(P.lib,j.handlePostMessage)),P.util.isTopWindow()||P.util.addEventListener(E,"load",P.util.createDelegate(P.lib,j.handleChildPageLoad))},setFeedbackOptions:function(e){P.util.isObject(e)&&(P.util.isString(e.console)&&x.feedback.console[e.console]&&(S.console=e.console),P.util.isString(e.inScreen)&&x.feedback.inScreen[e.inScreen]&&(S.inScreen=e.inScreen)),0<E.location.href.toLowerCase().indexOf("adndebug123")&&(S.inScreen=x.feedback.inScreen.inAdUnit);var t=C.getQueryParamsByName("console")||(P.util.getFrameElement()?P.util.getFrameElement().getAttribute(d):null);P.util.isString(t)&&x.feedback.console[t]&&(S.console=t);var i=C.getQueryParamsByName("inScreen");P.util.isString(i)&&x.feedback.inScreen[i]&&(S.inScreen=i)}},V=(L={cxense:{userId:"cX_P",sessionId:"cX_S"},relay42:{userId:"_svtri"}},R=function(t,e){var i=t.getItem(e);if(P.util.isString(i)&&0<i.length)try{return JSON.parse(i)}catch(e){return P.out.output("Error reading from local storage","cookie.getLs",e,t,i)}return{}},q=function(e,t){var i=R(E.localStorage,e);if(P.util.isArray(i)||(i=[]),!0===t)return i;if(e===I){var n=[];return P.util.forEach(i,function(e){w[e]===e&&n.push(e)}),n}var r={};return P.util.forEach(i,function(e){P.util.isNotBlankString(e.key)&&0<e.key.indexOf("!")&&(r[e.key]=e.value)}),r},{getAllIdsAsObj:function(){var e=V.getIdsAsObj(),t=V.get(L.relay42.userId),i=[];if(e&&e.userId&&i.push({CXENSE:{userId:e.userId}}),t&&i.push({RELAY42:{userId:t}}),!(i.length<1))return{userAliases:JSON.stringify(i)}},getIdsAsObj:function(e){return e&&e.userId&&e.sessionId||(V.getIds(),s)?{userId:(e||{}).userId||s.userId,sessionId:(e||{}).sessionId||s.sessionId}:P.out.output("No user ids specified")},getIds:function(e){if(!(s&&s.sessionId&&s.userId)){var t=L[e||"cxense"];P.util.forEach(t,function(e,t){s[t]=V.get(e)})}},get:function(e){for(var t=e?e+"=":null,i=t?null:{},n=decodeURIComponent(T.cookie).split(";"),r=0;r<n.length;r++){for(var s=n[r];" "===s.charAt(0);)s=s.substring(1);if(t){if(0===s.indexOf(t))return s.substring(t.length,s.length)}else{var a=s.split("=");i[a[0]]=a[1]}}return P.util.isObject(i)?i:""},set:function(e){P.util.forEach(e,function(e,t){var i=new Date;i.setTime(i.getTime()+2592e6);var n="; expires="+i.toUTCString();T.cookie=t+"="+(e||"")+n+"; path=/"})},clearAdvLocalStorage:function(){E.localStorage.removeItem(I),E.localStorage.removeItem(a),E.sessionStorage.removeItem(a)},writeConsent:function(t){if(!t||!P.util.isArray(t))return P.out.devOutput("Not a valid consent object","writeConsent",t);if(o){var i=[];P.util.forEach(t,function(e){w[e]===e?i.push(e):P.out.devOutput("Invalid consent item","writeConsent",t)});try{i.length<1?E.localStorage.removeItem(I):E.localStorage.setItem(I,JSON.stringify(i))}catch(e){P.out.output("Problem setting item","writeConsent",e,i)}}},getConsent:function(){return o?q(I):[]},writeAdvLs:function(t){if(!P.util.isObject(t)||!P.util.hasProperties(t))return P.out.devOutput("Not an object of data","writeAdvLs");if(o){var i={},n=[],e=q(a,!0);P.util.forEach(e,function(e){P.util.isNotBlankString(e.value)&&P.util.isNotBlankString(e.key)&&0<e.key.indexOf("!")&&!t[e.key]&&e.exp&&e.exp>C.getUnixTimestamp()&&n.push(e)}),P.util.forEach(t,function(e,t){-1<t.indexOf("session")?i[t]=e:0<t.indexOf("!")&&n.push({exp:C.getUnixTimestamp(100),key:t,value:e})});var r={};P.util.forEach(i,function(e,t){r[t]=e});try{E.sessionStorage.setItem(a,JSON.stringify(r)),E.localStorage.setItem(a,JSON.stringify(n))}catch(e){P.out.output("Problem setting item","writeAdvLs",e,r,n)}}},writeDatLs:function(e){if(!P.util.isObject(e)||!P.util.hasProperties(e))return P.out.devOutput("Not an object of data","writeAdvLs");if(o){var i={},n={};P.util.forEach(e,function(e,t){0===t.indexOf("sessionId")?i[t]=e:0===t.indexOf("browserId")?n[t]=e:0===t.indexOf("extSync")&&(n[t]=e)});try{E.sessionStorage.setItem(t,JSON.stringify(i)),E.localStorage.setItem(t,JSON.stringify(n))}catch(e){P.out.output("Problem setting item","writeDatLs",e,i,n)}}},getAllDatStorageAsObj:function(){return o?C.assign(R(E.sessionStorage,t),R(E.localStorage,t)):{}},getAllAdvStorageAsObj:function(){return o?C.assign(q(a),function(){var e=R(E.sessionStorage,a);P.util.isObject(e)||(e={});var i={};return P.util.forEach(e,function(e,t){P.util.isNotBlankString(t)&&0<t.indexOf("!")&&(i[t]=e)}),i}()):{}}}),B={},F={distributeComposedAds:function(a){var o=!1,u=[],d="";P.util.forEach(a.adUnits||a,function(t){var e=P.util.find(O,function(e){return e.targetId===t.targetId&&e.adStatus===x.adStatus.init});if(e)if(e.ads=t.ads,e.returnedKeywords=a.keywords,e.returnedSegments=a.segments,d=e.renderedImpRequestLoc,0<t.matchedAdCount&&0<t.html.indexOf("adnOptionContainerDiv")&&(e.container=x.container.div),0<t.matchedAdCount&&0<t.html.indexOf("adnOptionContainerIframe")&&(e.container=x.container.iframe),0===t.matchedAdCount){e.adStatus=x.adStatus.processed;var i=C.copyArgValues({matchedAdCount:t.matchedAdCount,html:t.html},e,["auId","targetId","auW","auH","kv","userSegments","c","ps","replacements","auml","floorPrice","requestArgs"]);i.retAdCount=0,i.retAdsW=0,i.retAdsH=0,i.h=0,i.w=0,P.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(i),P.util.isFunction(e.onPageLoad)&&e.onPageLoad(i)}else if(C.getParam(e.requestParams,"load")!==x.loadEnums.lazy||e.withinBounds){var n=P.lib.showAdContent(e,t);P.util.isTrue(n)&&(e.adStatus=x.adStatus.distributed,P.util.forEach(t.rts||[],function(e){u.push(e)}))}else{o=!0,e.adStatus=x.adStatus.procured,t.renderedImpRequestLoc=d;var r=C.getDocEl(e),s=y[t.targetId];r&&s?(s.errorStatus="",F.showTargetDiv(r,e),r.style.width=P.util.dimension(e.auW),r.style.height=P.util.dimension(e.auH)):(s.errorStatus=x.errorStatus.noTarget,P.out.output("Unable to find target element","distributeComposedAds",e))}else P.out.output("No ad unit data found, mismatched target probably or not the right status","composed",e)}),P.lib.sendRenderedImps(u,d),o&&W.initProximity()},showTargetDiv:function(e,t){e&&(P.util.isString(t.display)&&e.style.display!==t.display?e.style.display=t.display:"none"===e.style.display&&(e.style.display="block"))},insIframe:function(e,t){var i=t&&t.targetId===e.targetId||C.getDocEl(e);if(!i&&"script"!==e.format)return P.out.warn("Unable to find HTML element on page with the following id or class: "+e.targetId+" - "+e.targetClass),P.out.output("No targetId was found.","insIframe");var n=T.createElement("iframe");n.id=e.widgetId,n.name=e.widgetId,n.setAttribute(p,P.util.isTopWindow()),n.allowTransparency=!0,n.setAttribute(d,S.console);var r={ifrId:n.id};if(e.serverUrl){e.env&&e.env!==x.env.production.id&&x.env[e.env]&&(r[m]=e.env);var s=C.encodeUrlParams(e.serverUrl,r,e);if(5<e.serverUrl.length){s+=C.encodeAsUrlParams(V.getIdsAsObj(e),!0),s+=C.encodeAsUrlParams(V.getAllIdsAsObj()||{},!0);var a=V.getConsent();if(0<a.length&&(s+=C.encodeAsUrlParams({consent:a},!0)),!P.util.isTopWindow()){var o={"data-parent-top":!1};s+=C.encodeAsUrlParams(o,!0)}}if(!s)return P.out.output("Failure to create server src","insIframe",s);n.src=s}if(n.setAttribute("style","display: block; margin: 0; borderWidth: 0; padding: 0;"),n.setAttribute("scrolling","no"),n.frameBorder="0",e.isolateFrame&&C.supportsSrcDoc()&&n.setAttribute("sandbox","allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation"),"script"===e.format){var u=n.src;u+=C.encodeAsUrlParams({format:"script"},!0),T.write("<script src='"+u+"'><\/script>")}else n.width=P.util.isString(e.auW)||0<e.auW?e.auW:0,i.style.width=P.util.isNumber(e.auW)&&0<e.auW?P.util.dimension(n.width):n.width,n.height=P.util.isString(e.auH)||0<e.auH?e.auH:0,i.style.height=P.util.isNumber(e.auH)&&0<e.auH?P.util.dimension(n.height):n.height,i.appendChild(n);return F.showTargetDiv(i,e),n}},W=(N=!(i="012356789bcdfghjklmnpqrstvwxyz"),D=function(e,t,i){var n=e,r=!t||!t.rt;try{if(r||(n+=C.encodeAsUrlParams({rt:t.rt},!0)),C.isTestAddress(n)||C.isTestAddress(C.getLocationHref()))P.out.devOutput(i+" being sent","sending"+i+"Event",n);else{var s,a=P.util.getNewAjax(r?"GET":"POST",n,function(){if(a.readyState&&4!==a.readyState)return!1;if((!a.status||200===a.status)&&P.util.isNotBlankString(a.responseText)){var e={};try{e=JSON.parse(a.responseText)}catch(e){return P.out.output(e,"ajax.onreadystatechange: catch block send event",a)}e&&e.metaData&&V.writeAdvLs(e.metaData)}});a.withCredentials=!C.isTestAddress(n),(s=k&&k.metaData?k.metaData:C.setAndReturnMetaData())?a.send(JSON.stringify(s)):a.send()}return!0}catch(e){return P.out.output("sending a "+i+" event failed",e),!1}},M=function(i,n,r,s,a,o){P.util.forEach(f,function(e){if(P.util.isString(e.rt)||!e.displayStatus){var t=l[i];P.util.isString(t)?e.displayStatus===x.displayStatus.displayed&&e[n]===x[n][r]&&(C.isSrcdocFrame()?C.postMessageToParent({impRequestLoc:t,spec:e,feedbackText:a,messageType:x.postMessageType.toParentIsolateAdVisibilityEvent}):D(t,e,a),e[n]=x[n][s],C.postMessageToParent({messageType:x.postMessageType.toParentAdVisibilityEvent,widgetId:e.widgetId,adId:e.adId,creativeId:e.creativeId,viewability:e.viewability,callbackProp:o,debugMessage:a+" sent",isDivContainer:e.isDivContainer})):P.out.output("Missing a imp request location","send"+a+"Impression",l,i)}else P.out.output("Need a response token on the spec object to send imp","send"+a+"Impression",e)})},{sendEventFromParent:function(e,t,i){D(e,t,i)},sendClick:function(e){D(e,null,"Click")},sendVisibilityImpressions:function(){M("visible","visibilityStatus","visible","visibleSent","Visible","onVisible")},sendViewableImpressions:function(){M("viewable","viewabilityStatus","viewed","viewSent","Viewable","onViewable")},cancelProximityListeners:function(){P.util.detachEventListener(E,"resize",W.takeProximity),P.util.detachEventListener(E,"scroll",W.takeProximity)},cancelViewabilityListeners:function(){P.util.detachEventListener(E,"resize",W.takeViewability),P.util.detachEventListener(E,"scroll",W.takeViewability)},initViewability:function(){P.util.isTopWindow()&&(W.takeViewability(),!1===N&&(N=E.setInterval(W.takeViewability,203)),P.util.addEventListener(E,"resize",W.takeViewability),P.util.addEventListener(E,"scroll",W.takeViewability))},initProximity:function(){P.util.isTopWindow()&&(W.takeProximity(),P.util.addEventListener(E,"resize",W.takeProximity),P.util.addEventListener(E,"scroll",W.takeProximity))},takeProximity:function(){var p,m,e=P.util.filter(O,function(e){return(e.adStatus===x.adStatus.procured||C.getParam(e.requestParams,"load")===x.loadEnums.lazyRequest)&&!e.withinBounds});if(0===e.length)return W.cancelProximityListeners(),P.out.devOutput("No more ads to proximity check","takeProximityReading",O);if(P.util.isTopWindow()){try{p=P.util.getWindowSize()}catch(e){P.out.output("takeProximityReading window size calcs off",e)}try{m=P.util.getScrollPos()}catch(e){P.out.output("takeProximityReading scroll calcs off",e)}var v=[],h="";P.util.forEach(e,function(e){try{var t=C.getDocEl(e);if(!t)return void P.out.devOutput("Missing appearance of element","takeProximity",t,e);var i=t.style.display;"none"===i.toLowerCase()&&(t.style.display="block");var n=P.util.getElementPosition(t),r=(t.offsetWidth,t.offsetHeight),s=P.util.isNumber(C.getParam(e.requestParams,"proximity"))?C.getParam(e.requestParams,"proximity"):x.defaultProximity,a=m.top,o=(m.left,m.top+p.height),u=m.left+p.width,d=n.top,l=n.left,c=n.top+r;if(n.left,d-o<s&&-1*s<c-a&&l-u<s&&(e.withinBounds=!0,e.adStatus===x.adStatus.procured)){e.adStatus=x.adStatus.distributed;var f=y[e.targetId];if(!P.util.isObject(f))return P.out.output("Can't find composed ad details","proximity",y,e);var g=P.lib.showAdContent(e,f);P.util.isTrue(g)&&(P.util.forEach(f.rts||[],function(e){v.push(e)}),h=f.renderedImpRequestLoc)}t.style.display=i}catch(e){P.out.output("some catch error for takeProximityReading",e)}}),P.lib.sendRenderedImps(v,h)}},takeViewability:function(e){var h,y,b=!1,I=!1,w=P.util.isTrue(e),t=P.util.isTopWindow()&&!w?O:f,i=P.util.filter(t,function(e){return e.displayStatus===x.displayStatus.displayed&&e.viewabilityStatus===x.viewabilityStatus.notViewed&&!e.isNested});if(0===i.length)return W.cancelViewabilityListeners(),E.clearInterval(N),N=!1,P.util.isTopWindow()&&!w||C.postMessageToParent({messageType:x.postMessageType.toParentAllChildrenViewed,widgetId:P.inIframe.getIframeId(),functionContext:x.functionContext.parent,method:"allChildrenViewed"}),P.out.devOutput("No more ads to viewability check","takeViewabilityReadings",O,f,P.util.isTopWindow());try{(h=P.util.getWindowSize()).width=Math.max(h.width,1),h.height=Math.max(h.height,1),k.prevWindowWidth===h.width&&k.prevWindowHeight===h.height||(k.prevWindowWidth=h.width,k.prevWindowHeight=h.height)}catch(e){P.out.output("takeViewabilityReading window size calcs off",e)}try{y=P.util.getScrollPos(),k.prevScrollLeft===y.left&&k.prevScrollTop===y.top||(k.prevScrollLeft=y.left,k.prevScrollTop=y.top),k.maxViewLeft=Math.max(y.left+h.width,k.maxViewLeft),k.maxViewTop=Math.max(y.top+h.height,k.maxViewTop)}catch(e){P.out.output("takeViewabilityReading scroll calcs off",e)}var S,A=(new Date).getTime();if(w){k.childPrevTime=k.childPrevTime||{};var n=i[0].widgetId;k.childPrevTime[n]=k.childPrevTime[n]||(new Date).getTime(),S=A-k.childPrevTime[n],k.childPrevTime[n]=A}else k.prevTime=k.prevTime||(new Date).getTime(),S=A-k.prevTime,k.prevTime=A;P.util.forEach(i,function(e){try{var t=T.getElementById(e.adId||e.widgetId);if(!t)return e.viewabilityStatus=x.viewabilityStatus.divMissing,void P.out.devOutput("Missing div","takeViewabilityReading",e);var i=P.util.getElementPosition(t),n={width:Math.max(t.offsetWidth,1),height:Math.max(t.offsetHeight,1)},r=Math.max(i.left,y.left),s=Math.min(i.left+n.width,y.left+h.width),a=Math.max(i.top,y.top),o=Math.min(i.top+n.height,y.top+h.height),u=k.metricsFromParent;if(u){var d=u.overlapPos.left+y.left,l=u.overlapPos.left+u.overlapSize.width+y.left,c=u.overlapPos.top+y.top,f=u.overlapPos.top+u.overlapSize.height+y.top;r=Math.max(d,r),s=Math.min(l,s),a=Math.max(c,a),o=Math.min(f,o)}var g=Math.max(s-r,0),p=Math.max(o-a,0),m=Math.round(g*p/(n.width*n.height)*100);if(m>x.defaultVisibilityPercentage&&e.visibilityStatus===x.visibilityStatus.notVisible&&(P.util.isTopWindow()&&!w||(e.visibilityStatus=x.visibilityStatus.visible,I=!0)),100===m&&100===e.viewability.prevPercent&&e.viewability.timeFully<x.longestTime&&(e.viewability.timeFully+=S),50<=m&&50<=e.viewability.prevPercent&&e.viewability.timeHalf<x.longestTime&&(e.viewability.timeHalf+=S),0<m&&0<e.viewability.prevPercent&&e.viewability.timePartly<x.longestTime?e.viewability.timePartly+=S:e.viewability.timeNone+=S,m>e.viewability.maxPercent&&(e.viewability.maxPercent=m),e.viewability.prevPercent=m,(1e3<e.viewability.timeFully||1e3<e.viewability.timeHalf)&&e.viewabilityStatus===x.viewabilityStatus.notViewed&&(P.util.isTopWindow()&&!w||(e.viewabilityStatus=x.viewabilityStatus.viewed,b=!0)),P.util.isTopWindow()&&!w){var v=[A,y.left,y.top,h.width,h.height,i.left,i.top,n.width,n.height,r-i.left,a-i.top,g,p];P.util.forEach(v,function(e,t){v[t]=Math.round(e)}),C.postMessageToChild(t,{messageType:x.postMessageType.toChildViewability,functionContext:x.functionContext.inIframe,method:"updateMetricsFromParent",metricsFromParent:v.join(","),metaData:V.getAllAdvStorageAsObj(),isDivContainer:e.container===x.container.div||e.isDivContainer})}}catch(e){P.out.output("takeViewabilityReading off",e)}}),I&&W.sendVisibilityImpressions(),b&&W.sendViewableImpressions()}}),z=(r=function(e,t,i){var n=O[e.widgetId];if(!n&&e.widgetId!==x.previewId)return P.out.output("Couldn't find widget specs for "+e.widgetId,"checkArgs");var r=i||T.getElementById(e.widgetId)||T.getElementById(x.previewId);return r?n?t.call(z,r,n,e):void 0:P.out.output("Couldn't find widget in the document","checkArgs")},{allChildrenViewed:function(e){var t=O[e.widgetId];t&&(t.visibilityStatus=x.visibilityStatus.visible,t.viewabilityStatus=x.viewabilityStatus.viewed)},updateIframe:function(e){return r(e,function(e,t,i){P.util.isDefined(i.w)&&(e.width=i.w),P.util.isDefined(i.h)&&(e.height=i.h);var n=e.parentNode;"relative"===i.stack?(n.style.position="relative",e.style.position="absolute"):"absolute"===i.stack?(P.util.isBlankString(n.style.position)||"relative"!==n.style.position||(n.style.position="static"),e.style.position="absolute"):(P.util.isBlankString(e.style.position)||"static"===e.style.position||(e.style.position="static"),P.util.isDefined(e.width)&&(n.style.width=P.util.dimension(e.width)),P.util.isDefined(e.height)&&(n.style.height=P.util.dimension(e.height))),P.util.isDefined(i.ifrStyle)&&!P.util.isBlankString(i.ifrStyle)&&C.applyStyle(e,i.ifrStyle),P.util.isDefined(i.targetStyle)&&!P.util.isBlankString(i.targetStyle)&&C.applyStyle(n,i.targetStyle)})},triggerViewabilityReading:function(e){r(e,function(e,t){t.adStatus=x.adStatus.processed,t.displayStatus=x.displayStatus.displayed,W.initViewability()})},iframeResizer:function(e,d,l){return r(e,function(e,t,i){var n=parseInt(i.w,10),r=parseInt(i.h,10),s=P.util.isDefined(l)?l:t.collapsible;if(n<0||r<0)return P.out.output("Invalid width ("+i.w+") and height ("+i.h+") for resize","iframeResizer");var a=0===n,o=0===r;if((a||o)&&!s)return P.out.devOutput("Resize to zero not allowed -- ad unit is not collapsible","iframeResizer",i,s);e.width=i.w,e.height=i.h;var u=e.parentNode;u.style.width=P.util.dimension(i.w),u.style.height=P.util.dimension(i.h),(a||o)&&d&&(e.style.display="none",u.style.display="none")})},styleFromAds:function(e){var t=parseInt(e.retAdCount,10),i=O[e.widgetId];if(0===t)z.iframeResizer({widgetId:e.widgetId,w:0,h:0},S.inScreen!==x.feedback.inScreen.inAdUnit);else{if(!(P.util.isNumber(t)&&0<t))return P.out.output("adCount is not valid: "+t,"styleFromAds");if(!i||!P.util.hasProperties(i))return P.out.output("Missing widget spec","styleFromAds",e);i.displayStatus=x.displayStatus.displayed,W.initViewability(),z.iframeResizer({widgetId:e.widgetId,w:parseInt(e.retAdsW,10),h:parseInt(e.retAdsH,10)},!1,!1)}}});P.inIframe=function(){var e=!0,t={},n=[],d=[],r=[],s={};C.isTestAddress(E.location.href),B={handleAdUnitInfo:function(e){if(!e||!P.util.isString(e.adUnitInfoId))return P.out.output("Missing ad unit info id for ad unit info response","handleAdUnitInfo",e);var t=s[e.adUnitInfoId];if(!t||!P.util.isArray(t)||t.length<1)return P.out.output("Missing some ad unit info response handlers","handleAdUnitInfo",s,e);var i=e.adUnitInfo,n=C.copyArgValues({},i,["auId","latitude","longitude","adStatus","auH","auW","collapsible","display","c","kv","replacements","auml","ps","displayStatus","targetId","targetClass","widgetId","functionCalls","requestParams","method","onNoMatchedAds","onImpressionResponse","onPageLoad","usi","siteId","userId","sessionId","segments","userSegments","resizeOnPageLoad","ctx"]);P.util.forEach(t,function(e){e(n)})},handleChildPubs:function(i){if(!P.util.isObject(i)||!P.util.isString(i.widgetId)||!P.util.isString(i.event))return P.out.output("Missing some args","handleChildPubs",i);P.util.forEach(i.functionCalls||[],function(t){if(t.name){var e=P.util.filter(r,function(e){return e.name===t.name&&P.util.isFunction(e.func)&&!0!==e.isCalled});P.util.forEach(e||[],function(e){e.func(t.args),e.isCalled=!0})}else P.out.output("Missing a name parameter for a function call","handleChildPubs",i)}),P.util.forEach(t[i.event]||[],function(e){if(e.widgetId===i.widgetId){var t={};P.util.isObject(i.windowDims)&&(t.windowDims=i.windowDims),P.util.isObject(i.widgetDims)&&(t.widgetDims=i.widgetDims),P.util.isObject(i.widgetParentDims)&&(t.widgetParentDims=i.widgetParentDims),e.cb(t)}})},updateMetricsFromParent:function(e){if(!e||!P.util.isObject(e))return P.out.devOutput("Missing required args","updateMetricsFromParent",e);if(e.metricsFromParent&&!e.isDivContainer){var i=e.metricsFromParent.split(",");P.util.forEach(i,function(e,t){i[t]=parseInt(e,10)}),k.metricsFromParent={updateTime:i[0],scrollPos:{left:i[1],top:i[2]},windowSize:{width:i[3],height:i[4]},widgetPos:{left:i[5],top:i[6]},widgetSize:{width:i[7],height:i[8]},overlapPos:{left:i[9],top:i[10]},overlapSize:{width:i[11],height:i[12]}}}e.metaData&&(k.metaData=e.metaData),P.util.forEach(n,function(e){e()}),n=[],W.takeViewability(P.util.isTrue(e.isDivContainer))}};return{sendCustomEvent:function(a,o,t){var i=C.getParam(a,"id")||a;if(!P.util.isDefined(i)||!P.util.isString(C.getParam(o,"customType")))return P.out.output("Missing an ad ID or customType to perform the custom event","sendCustomEvent",a,o);var e=function(){return t||P.util.find(f,function(e){return e.adId===i})},n=function(e){if(C.isSrcdocFrame()&&!t)return C.postMessageToParent({args:a,customArgs:o,pAdSpec:e,messageType:x.postMessageType.toParentCustomEvent});!function(e){if(!P.util.isObject(e))return P.out.output("Need an ad spec to send a custom event","sendCustomEvent",f,a,o);if(!P.util.isString(e.rt))return P.out.output("Need a response token on the spec object to send imp","sendCustomEvent",e,f,a,o);var t=P.lib.getRequestLocs({env:g?"http://localhost:8000/test":P.lib.getEnv()}).custom;if(e&&O&&O[e.widgetId]&&(t=O[e.widgetId].customRequestLoc),!t)return P.out.output("Need a custom request loc","sendCustomEvent",t,e,f,a,o);try{var i=parseInt(o.customValue,10),n={rt:e.rt,customType:o.customType,customValue:P.util.isNumber(i)?i:0};0===n.customValue&&delete n.customValue;var r=t+C.encodeAsUrlParams(n,!0);if(C.isTestAddress(r))P.out.devOutput("Custom request loc being send","sending",e,r);else{var s=P.util.getNewAjax("GET",r);s.withCredentials=!C.isTestAddress(r),s.send()}}catch(e){P.out.output("sending a custom event failed",e,f,a,o)}}(e)},r=e();r?n(r):d.push(function(){return n(e())})},getResponseCtrId:function(){var t,e=T.getElementsByTagName("div");return P.util.forEach(e,function(e){if(0===e.id.indexOf("adn-rsp-"))return t=e,!1;t||0!==e.id.indexOf(x.widgetIdPrefix)||(t=e)}),t?t.id:"responseCtr"},blockViewability:function(e){if(!P.util.isNotBlankString(e))return P.out.output("Need to supply the ad id to block viewability","blockViewability",e);f[e]=f[e]||{},f[e].viewabilityStatus=x.viewabilityStatus.blocked},blockResizeToContent:function(){e=!1},isResizeToContent:function(){return e},getAdRequestInfo:function(e){if(!e||!P.util.isFunction(e.onInfoReceived))return P.out.output("Need onData function populated","getAdRequestInfo",e);var t=e.adUnitInfoId||"adUnitInfoId-"+Math.random();s[t]=s[t]||[],s[t].push(e.onInfoReceived),C.postMessageToParent({messageType:x.postMessageType.toParentGetAdUnitInfo,adUnitInfoId:t,widgetId:P.inIframe.getIframeId()})},registerFunction:function(e){if(!P.util.isString(e.name)||!P.util.isFunction(e.func))return P.out.output("Missing important parameters",e);r.push(e)},processAdResponse:function(e){if(!e||!P.util.isNumber(e.matchedAdCount))return P.out.output("Missing the necessary args in "+e,"resizeAds");var t=e.widgetId,i=e.widgetId;if(t||(t=P.inIframe.getIframeId(),i=P.inIframe.getResponseCtrId()),!t&&P.lib.isParentTopWindow())return P.out.devOutput("Unable to find iframeId","processAdResponse",t,e);!function(n,e,t){var i,r={},s=[];try{if(!(i=T.getElementById(e)))return P.out.output("Can't find the ads container","processAd",n,e,t,i);r=P.util.getElementDimensions(i),s=P.util.filter(i.getElementsByTagName("div"),function(e){return-1<e.className.indexOf(x.cwClass)&&0===e.id.indexOf(x.adIdPrefix)})}catch(e){r={}}l=P.lib.getRequestLocs({env:g?"http://localhost:8000/test":P.lib.getEnv()},!1);var o=i&&"div"===i.tagName.toLowerCase()&&(e!==P.inIframe.getResponseCtrId()||0===e.indexOf(x.widgetIdPrefix)),u=!o&&(!n||!P.lib.isParentTopWindow())||o&&(!n||!P.util.isTopWindow());P.util.forEach(s,function(e){var t=f[e.id]||{};if(f[e.id]={widgetId:n,isNested:u,isDivContainer:o,adId:e.id,creativeId:e.getAttribute("data-creative-id"),rt:e.getAttribute("data-response-token"),adStatus:x.adStatus.processed,displayStatus:x.displayStatus.displayed,viewabilityStatus:t.viewabilityStatus||x.viewabilityStatus.notViewed,visibilityStatus:x.visibilityStatus.notVisible,viewability:{maxPercent:0,prevPercent:0,timeNone:0,timePartly:0,timeHalf:0,timeFully:0,timeIntersect:0,timeStart:0}},u&&C.supportsIntersectionObserver()){var r=e.id,i=!1;(i=new E.IntersectionObserver(function(e){var t=f[r];t.visibilityStatus===x.visibilityStatus.notVisible&&0<e[0].intersectionRatio&&(t.visibilityStatus=x.visibilityStatus.visible,W.sendVisibilityImpressions(),!P.util.find(f,function(e){return e.isNested&&e.visibilityStatus===x.visibilityStatus.notVisible})&&i&&i.disconnect())},{root:null,rootMargin:"0px",threshold:.01})).observe(T.getElementById(r));var s=!1,a=!1;(a=new E.IntersectionObserver(function(e){var t=f[r],i=(new Date).getTime();if(t.viewabilityStatus===x.viewabilityStatus.notViewed)if(.5<=e[0].intersectionRatio){t.viewability.timeStart=i;var n=1e3-t.viewability.timeIntersect;s=E.setTimeout(function(){t.viewability.timeIntersect=t.viewability.timeIntersect+(new Date).getTime()-t.viewability.timeStart,t.viewabilityStatus=x.viewabilityStatus.viewed,W.sendViewableImpressions(),E.clearTimeout(s),s=!1,!P.util.find(f,function(e){return e.isNested&&e.viewabilityStatus===x.viewabilityStatus.notViewed})&&a&&a.disconnect()},n)}else s&&0<t.viewability.timeStart&&(t.viewability.timeIntersect=t.viewability.timeIntersect+(new Date).getTime()-t.viewability.timeStart,t.viewability.timeStart=0,E.clearTimeout(s),s=!1)},{root:null,rootMargin:"0px",threshold:.5})).observe(T.getElementById(r))}});var a=T.getElementsByClassName("adn-external-container");P.util.forEach(a,function(i){var e=i.parentNode;e&&e.className&&!(e.className.indexOf(x.cwClass)<0)&&i.href&&P.util.addEventListener(e,"click",function(e){for(var t=e.target;t&&"a"!==t.nodeName.toLowerCase();)t=t.parentNode;t&&!C.getEnvFromHref(t.href)&&W.sendClick(i.href)})}),P.util.forEach(d,function(e){e()}),d=[],C.postMessageToParent({messageType:x.postMessageType.toParentImpression,method:P.inIframe.isResizeToContent()?"styleFromAds":"triggerViewabilityReading",retAdCount:t,retAdsW:r.w,retAdsH:r.h,widgetId:n,isDivContainer:o})}(t,i,e.matchedAdCount)},getIframeArgs:function(){return C.combineArgs(C.parseUrlArgs(),C.parseHashArgs())},getIframeId:function(e){if(e&&0===e.indexOf(x.widgetIdPrefix))return e;var t=T.getElementsByTagName("body")[0].id;if(t&&0===t.indexOf(x.widgetIdPrefix))return t;var i=P.inIframe.getIframeArgs().ifrId;if(P.util.isNotBlankString(i)&&i!==x.previewId)return i;var n="";i===x.previewId&&(n=x.previewId);var r=P.util.getFrameElement();return P.util.isDefined(r)?r.id:n},parentSubscribeEvent:function(e){if(!(P.util.isObject(e)&&P.util.isString(e.event)&&P.util.isString(e.ifrId)&&P.util.isFunction(e.cb)))return P.out.output("Need better args","parentSubscribeEvent",e);C.postMessageToParent({messageType:x.postMessageType.toParentSubscribe,event:e.event,widgetId:e.ifrId}),t[e.event]=t[e.event]||[],t[e.event].push({widgetId:e.ifrId,cb:e.cb})},updateAd:function(t){if(!t||!t.ifrId)return P.out.output("Need arguments and an iframe id","inIframe",t);var e=t.method||"updateIframe",i=t.targetStyle||t.parentStyle,n={messageType:x.postMessageType.toParentUpdateAd,method:e,w:t.ifrW||"",h:t.ifrH||"",params:P.util.isObject(t.params)?t.params:"",ifrStyle:P.util.isObject(t.ifrStyle)?t.ifrStyle:"",targetStyle:P.util.isObject(i)?i:"",widgetId:t.ifrId,stack:t.stack||"static"};t.el&&t.event?P.util.addEventListener(t.el,t.event,P.util.createDelegate(P.util,function(e){if(C.postMessageToParent(n),t.cb){if(!P.util.isFunction(t.cb))return P.out.output("Callback supplied not a function","inIframe");t.cb(e,t)}})):C.postMessageToParent(n)}}}(),function(){var v,r,n=function(t){var u=P.lib.getRequestLocs(t,!0);v=[],r=[];var i=function(e,t,i,n){var r=P.util.isObject(i)?C.clone(i):{},s=Math.random(),a={auId:t.auId||t.targetId||t.widgetId,requestArgs:n,parentArgs:i,auArgs:t,format:"script"===t.format?"script":void 0,creativeId:t.creativeId,creativeData:t.creativeData,requestMode:x.requestMode[r.requestMode||t.requestMode]||x.requestMode.DEFAULT,networkId:t.networkId||r.networkId,widgetId:t.widgetId||x.widgetIdPrefix+s,auW:t.auW||t.creativeWidth||0,auH:t.auH||t.creativeHeight||0,display:t.display||void 0,c:t.c||r.c||void 0,ctx:t.ctx||r.ctx||E.location.href,kv:t.kv||r.kv||void 0,auml:t.auml||void 0,replacements:t.replacements||r.replacements,segments:t.segments||r.segments,userSegments:r.userSegments||t.userSegments,ps:P.util.isNumber(t.ps)?t.ps:void 0,adStatus:x.adStatus.init,displayStatus:x.displayStatus.notDisplayed,container:x.container[t.container||r.container||"nothing"]||x.container.iframe,env:t.env||r.env||x.env.production.id,viewabilityStatus:x.viewabilityStatus.notViewed,visibilityStatus:x.visibilityStatus.notVisible,impRequestLoc:u.imp,floorPrice:t.floorPrice||r.floorPrice||void 0,protocol:t.protocol||r.protocol||void 0,renderedImpRequestLoc:u.rendered,viewImpRequestLoc:u.viewable,visImpRequestLoc:u.visible,customRequestLoc:u.custom,previewLoc:u.preview,headerBids:t.headerBids||r.headerBids,functionCalls:t.functionCalls||r.functionCalls,requestParams:C.assign(r.requestParams||{},t.requestParams||{}),collapsible:!1!==t.collapsible,method:r.method||t.method,devScript:t.devScript||!1,excludedCreatives:r.excludedCreatives||[],excludedLineItems:r.excludedLineItems||[],onError:t.onError||r.onError||P.util.noop,onVisible:t.onVisible||r.onVisible||P.util.noop,onViewable:t.onViewable||r.onViewable||P.util.noop,onNoMatchedAds:t.onNoMatchedAds||r.onNoMatchedAds,onImpressionResponse:t.onImpressionResponse||r.onImpressionResponse,onPageLoad:t.onPageLoad||r.onPageLoad,siteId:t.siteId||r.siteId,usi:t.usi||r.usi,userId:t.userId||r.userId,useCookies:!(!1===t.useCookies||!1===r.useCookies),sessionId:t.sessionId||r.sessionId,latitude:t.latitude||r.latitude,longitude:t.longitude||r.longitude,clearTarget:P.util.isDefined(t.clearTarget)?t.clearTarget:P.util.isTrue(r.clearTarget),targetClass:r.targetClass||t.targetClass,targetId:t.targetId||"adn-"+(t.auId||t.creativeId)+(r.targetClass||t.targetClass?s:""),isolateFrame:P.util.isDefined(t.isolateFrame)?t.isolateFrame:r.isolateFrame||!1,serverUrl:u.imp+"&auId="+t.auId,resizeOnPageLoad:P.util.isDefined(t.resizeOnPageLoad)?t.resizeOnPageLoad:r.resizeOnPageLoad,viewability:{maxPercent:0,prevPercent:0,timeNone:0,timePartly:0,timeHalf:0,timeFully:0}};if(P.util.isNumber(t.refresh)&&(a.refresh={delay:parseInt(t.refresh,10),event:"onViewable",count:1}),P.util.isObject(t.refresh)&&P.util.isNumber(t.refresh.delay)&&(a.refresh={delay:parseInt(t.refresh.delay,10),event:"onVisible"===t.refresh.event?t.refresh.event:"onViewable",count:P.util.isNumber(t.refresh.count)&&0<P.util.isNumber(t.refresh.count)?parseInt(t.refresh.count):1}),a.devScript&&(a.serverUrl+="&isDevScript=true"),e.push(a),!a.targetClass){var o=P.util.filter(O,function(e){return e.targetId===a.targetId});a.duplicateId=0<o.length}O[a.widgetId]=a},n=C.assign({},t);delete n.adUnits,delete n.creatives,P.util.isArray(t.adUnits)?P.util.forEach(P.util.isArray(t.adUnits)?t.adUnits:[],function(e){i(v,e,n,t)}):P.util.isArray(t.creatives)?P.util.forEach(P.util.isArray(t.creatives)?t.creatives:[],function(e){i(r,e,n,t)}):i(v,t,void 0,t)};h={ifr:function(){var e=v[0];return e&&e.auId?"dummyadunit-ignore"===e.auId||e.requestMode===x.requestMode.hasTarget&&!C.getDocEl(e)?(P.out.devOutput("Skipping ad request","ifr",e),P.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):void F.insIframe(e):P.out.output("No auId was found.","ifr")},preview:function(){if(r.length<1)return P.out.output("No creatives to make request for","preview");var n=r[0].previewLoc;C.gatherDataParams(r,null,function(e){O[e.widgetId].preview=!0}),P.util.forEach(r,function(r){if(!P.util.isString(r.networkId)||!P.util.isString(r.creativeId)&&!P.util.isObject(r.creativeData))return P.out.output("Insufficient creative information for preview","preview",r,r.onError);var e="POST",t=n+"context="+r.networkId;P.util.isString(r.creativeId)&&(e="GET",t+="&creativeId="+r.creativeId);var i,s=P.util.getNewAjax(e,t,function(){if(s.readyState&&4!==s.readyState)return!1;if(s.status&&200!==s.status)return P.out.output("Error status returned","composed",s,r.onError);var e;try{e=s.responseText}catch(e){return P.out.output(e,"ajax.onreadystatechange: catch block",r.onError)}var t=C.getDocEl(r);if(!t)return P.out.output("Couldn't find target element","Creative preview",r,t,r.onError);if(!P.util.find(t.childNodes,function(e){return e.id===r.widgetId})){r.serverUrl=null;var i=F.insIframe(r,t),n=i.contentDocument||i.contentWindow.document;n.open(),n.write(e),n.close()}});s.withCredentials=!C.isTestAddress(n),P.util.isObject(r.creativeData)&&(i=JSON.stringify(r.creativeData)),s.send(i)})},composed:function(e,t){var i=P.util.isArray(C.getParam(t,"adUnits"))?t.adUnits:v;if(i.length<1)return P.out.output("No ad units to make request for","composed");var n=P.util.isArray(e)?e:v;W.takeProximity();var r=i[0].impRequestLoc,s=i[0].headerBids,a=[],o=C.getParam(t,"requestId"),u=C.gatherDataParams(n,function(e){var t=O[e.widgetId],i=C.getParam(t.requestParams,"load")!==x.loadEnums.lazyRequest||t.withinBounds;return i||a.push(e),i&&("dummyadunit-ignore"===e.auId||e.requestMode===x.requestMode.hasTarget&&!C.getDocEl(e))?(P.out.devOutput("Skipping ad request","composed",e),P.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):i},function(e){O[e.widgetId].composed=!0}),d=u.adUnits,l=u.params;if(0<d.length){r+=C.encodeAsUrlParams(V.getIdsAsObj(i[0]),!0),r+=C.encodeAsUrlParams(V.getAllIdsAsObj()||{},!0),o||(o="request-"+Math.random());var c=S.inScreen===x.feedback.inScreen.inAdUnit?"format=json":"tt=multi",f=P.util.getNewAjax(C.isTestAddress(r)?"GET":"POST",r+"&"+c,function(){if(f.readyState&&4!==f.readyState)return!1;if(f.status&&200!==f.status)return P.out.output("Error status returned","composed",f,i[0].onError);var e;A=x.composedRequest.requestReturned;try{e=JSON.parse(f.responseText)}catch(e){return P.out.output(e,"ajax.onreadystatechange: catch block",i[0].onError)}return e.adUnits?(e.metaData&&V.writeAdvLs(e.metaData),P.util.forEach(e.adUnits,function(e){y[e.targetId]=e}),b[o]={requestId:o,duplicateFilter:C.getParam(e,"duplicateFilter")},void F.distributeComposedAds(e)):P.out.output("No ad units defined in returned data","composed",i[0].onError)});f.withCredentials=!C.isTestAddress(r);var g=C.gatherExclusions(i);g.adUnits=d,C.setAndReturnMetaData(g),P.util.isArray(s)&&(g.headerBids=s);var p=C.getParam(b[o],"duplicateFilter");p&&(g.duplicateFilter=p);var m=V.getConsent();0<m.length&&(g.consent=m),g=C.combineArgs(g,l),f.send(JSON.stringify(g)),A=x.composedRequest.requestMade}0<a.length&&E.setTimeout(function(){h.composed(a,{requestId:o,adUnits:i})},153)}};var e,t=(e=function(e){var t,i,n=P.util.getFrameElement()||(t=v[0],(i=C.getDocEl(t))?i.firstChild:(P.out.warn("Unable to find HTML element on page with the following id: "+t.targetId),P.out.output("No target element was found.","getWidgetEl")));n&&e(n)},{style:function(t){e(function(e){C.applyStyle(e,t.style)})},resize:function(t){e(function(e){P.util.isDefined(t.width)&&(e.style.width=P.util.dimension(t.width)),P.util.isDefined(t.height)&&(e.style.height=P.util.dimension(t.height))})}}),i=function(e,t,i){var n=e.method||i;return t[n]?t[n].call(this,e):P.out.output("Matching method not found for "+n,"init")};P.clearLocalStorage=function(){V.clearAdvLocalStorage()},P.useLocalStorage=function(e){o=!1!==e},P.useCookies=function(e){u=!1!==e},P.consent=function(e){var t=P.util.isArray(e)?{consent:e}:e;if(!t.consent||!P.util.isString(t.consent)&&!P.util.isArray(t.consent))return P.out.output("Not a valid network id or array object","adn.regConsent",e);V.writeConsent(P.util.isArray(t.consent)?t.consent:[t.consent])},P.regTargets=function(i){if(!P.util.isString(i.network)||!P.util.isArray(i.keyValues))return P.out.output("Not a valid network id or array object","adn.regTarget",i);var n=[];if(P.util.forEach(i.keyValues,function(e){if(P.util.isString(e.key)&&P.util.isString(e.value)){var t={key:e.key,value:e.value};e.expiry&&P.util.isInteger(e.expiry)&&(t.expiry=e.expiry),n.push(t)}else P.out.output("Missing an appropriate key and value for registering a target","adn.regTarget",e,i)}),n.length<1)return P.out.output("Missing appropriate targets to register","adn.regTarget",i);var e=P.lib.getRequestLocs(i).retargeting;if(!e)return P.out.output("Couldn't generate req url","regTargets",e,i);var t=P.util.getNewAjax("POST",e,function(){if(t.readyState&&4!==t.readyState)return!1;if(!t.status||200===t.status)return!0;var e=Math.floor(t.status/100);return 4===e?P.out.output("400 error","ajax.onreadystatechange in regTargets",t):5===e?P.out.output("500 error","ajax.onreadystatechange in regTargets",t):P.out.output("Misc error","ajax.onreadystatechange in regTargets",t)});t.open("POST",e),t.withCredentials=!C.isTestAddress(e),t.send(JSON.stringify({network:i.network,keyValues:n}))},P.renderComposedAds=function(){var e=function(){return P.util.filter(y,function(e){return e.errorStatus===x.errorStatus.noTarget})};if(A!==x.composedRequest.requestReturned)return-1;var t=e();return t.length<1?0:(F.distributeComposedAds(t),e().length)},P.contentWidget=function(c){if(!c)return P.out.output("Insufficient args to make a content widget","adn.contentWidget",c);if(P.util.isNotBlankString(c.auId)){if(!P.util.isArray(c.adPositions)||c.adPositions.length<1)return P.out.output("Insufficient args to make a content widget -- if auId is specified, need adPositions array","adn.contentWidget",c);if(!c.widgetId&&!P.util.isNotBlankString(c.template))return P.out.output("Insufficient args to make a content widget -- need a widget ID or a template if only an auId has been specified","adn.contentWidget",c)}if(!c.widgetId&&!c.auId)return P.out.output("Insufficient args to make a content widget -- need a widgetId or an auId specified","adn.contentWidget",c);var t,i,n=function(e,t){var o=!!(t&&t.responseJSON&&0<t.responseJSON.adUnits.length)&&t.responseJSON.adUnits[0].ads,u="",d=0,l={};if(e)try{l=JSON.parse(e)}catch(e){P.out.output("JSON parsing ajax content call failed","contentWidget",e,c)}l.template=c.template||l.template;var i=[];P.util.isArray(l.items)?i=l.items:P.util.isArray(c.adPositions)&&P.util.isArray(o)&&(i=c.adPositions.length>o.length?o:c.adPositions),P.util.forEach(i,function(n,e){if(o&&o[d]&&-1<c.adPositions.indexOf(e)){n={};var t=o[d].assets,i=o[d].text,r=c.adLabelText||"Ad";n.ad_label=c.adLabel?c.adLabel:'<div class="adLabel">'+r+"</div>",n.click_url=o[d].urls?o[d].urls.destination:"",n.dominantimage=t&&t.image?t.image.cdnId:"",n.title=i&&i.title?i.title.content:"",n.description=i&&i.description?i.description.content:"",d++}var s=l.template,a=s.match(/{{(\b\w*|\w*-\w*\b)}}/g);P.util.forEach(a,function(e){var t=e.replace("{{","").replace("}}",""),i=new RegExp(e,"g");s=n[t]?s.replace(i,n[t]):s.replace(i,"")}),u+=s});var n=c.targetId||"adn-"+(c.widgetId?c.widgetId:c.auId),r=T.getElementById(n);if(!r)return P.out.output("Couldn't find target targetElement","adn.contentWidget",n,c);r.innerHTML=u},e=function(e){if(e.response?i=e.response:t=e,c.auId&&c.widgetId){if(i&&t)return n(i,t)}else{if(c.auId&&t)return n(null,t);if(c.widgetId&&i)return n(i)}};if(c.auId&&P.requestData({auId:c.auId,onSuccess:e}),c.widgetId){var r=P.util.getNewAjax("POST","https://api.cxense.com/public/widget/data",function(){return(!r.readyState||4===r.readyState)&&(r.status&&200!==r.status?P.out.output("Poor response from cxense","adn.contentWidget",r):e(r))}),s={widgetId:c.widgetId,user:{ids:{usi:c.usi||V.get("cX_P")}},context:{url:c.url||E.location.href}};r.send(JSON.stringify(s))}},P.requestData=function(e){if(!P.util.isDefined(e.auId)&&!P.util.isArray(e.adUnits))return P.out.output("Need an ad unit id or adUnits to make this work.","adn.requestData",e);var n=C.assign({},e);if(!P.util.isFunction(n.onSuccess)&&!P.util.isFunction(n.onResponse))return P.out.output("Need a callback function to make the call worthwhile","adn.requestData",n,e);n.onSuccess=P.util.isFunction(n.onSuccess)?n.onSuccess:P.util.noop,n.onError=P.util.isFunction(n.onError)?n.onError:P.util.noop,n.onResponse=P.util.isFunction(n.onResponse)?n.onResponse:P.util.noop;var t,i=P.lib.getRequestLocs(n,!0).imp,r=[],s={};if(s=n.auId&&!P.util.isArray(n.adUnits)?(r=C.gatherDataParams([n],null,null,e).adUnits,n):(r=C.gatherDataParams(n.adUnits).adUnits)[0],!(t=C.encodeUrlParams(i,{format:"json"},e)))return P.out.output("Couldn't generate server url","requestData",t,e);t+=C.encodeAsUrlParams(V.getIdsAsObj(s),!0),t+=C.encodeAsUrlParams(V.getAllIdsAsObj()||{},!0);var a=P.util.getNewAjax("POST",t,function(){if(a.readyState&&4!==a.readyState)return!1;var t=function(e,t){var i=C.assign(e,{responseCode:a.status,responseText:a.responseText});n.onResponse(i),(t||n.onError)(i)};if(!a.status||200===a.status)try{var e=JSON.parse(a.responseText);return t({responseJSON:e},n.onSuccess),e.metaData&&V.writeAdvLs(e.metaData),e}catch(e){return t({error:e,errorText:"Error with parsing the response text"}),P.out.output("Parsing response text fail","ajax.onreadystatechange: catch block",e)}var i=Math.floor(a.status/100);return 4===i?(t({errorText:"Likely error in request made"}),P.out.output("400 error","ajax.onreadystatechange",a)):5===i?(t({errorText:"Likely error in service"}),P.out.output("500 error","ajax.onreadystatechange",a)):(t({errorText:"Error"}),P.out.output("Misc error","ajax.onreadystatechange",a))}),o=C.gatherExclusions(n);C.setAndReturnMetaData(o),o.adUnits=r;var u=V.getConsent();0<u.length&&(o.consent=u),a.send(JSON.stringify(o))},P.regConversion=function(e){if(!P.util.isNotBlankString(e.eventType))return P.out.output("Missing a value for eventType","regConversion",e);if(e.eventValue&&!P.util.isNumber(e.eventValue))return P.out.output("The event value must be a number","regConversion",e);var t=P.lib.getRequestLocs(e).conversion,i=P.util.getNewAjax(C.isTestAddress(t)?"GET":"POST",t,function(){if(i.readyState&&4!==i.readyState)return!1;if(i.status&&200!==i.status)return P.out.output("Error status returned","composed",i);var e;try{e=JSON.parse(i.responseText)}catch(e){return P.out.output(e,"ajax.onreadystatechange: catch block",i)}e.metaData&&V.writeAdvLs(e.metaData)});i.withCredentials=!0;var n=C.copyArgValues({},e,["network","adSource","eventType","eventValue"]);C.setAndReturnMetaData(n),i.send(JSON.stringify(n))},P.clearOut=function(){O={},l={},f={},y={},k={},b={}};var s=function(){var o=0;function r(n,r,s,a){--o<0||(n.initAdserverSet=!0,P.calls.push(function(){var e=function(){!a&&P.util.isTrue(C.getParam(s,"gptAsync"))&&n.setTargetingForGPTAsync&&n.setTargetingForGPTAsync();var e=P.util.isFunction(n.getBidResponses)?n.getBidResponses():[],t=P.util.isFunction(n.getNoBids)?n.getNoBids():[],i=P.util.isTrue(C.getParam(s,"debug"));i&&(a&&P.out.output("Prebid.js load timed-out","headerBidRequest"),P.out.output("Raw bid responses in prebid","headerBidRequest",e),P.out.output("The prebid requests with no bids","headerBidRequest",t)),r.headerBids=[],P.util.forEach(e,function(e){P.util.forEach(e.bids,function(e){var t=C.clone(e);t.dealId||delete t.dealId,r.headerBids.push(t)})}),P.util.forEach(t,function(e){P.util.forEach(e.bids,function(e){var t=C.clone(e);t.cpm=0,t.statusMessage="Bid returned empty or error response";var i=e.bidderCode||e.bidder;t.bidderCode=P.util.isNotBlankString(i)?i:"",P.util.isNotBlankString(i)||P.out.output("Invalid bidder code has been set. Needs to be a String.","headerBidRequest",e.bidderCode||e.bidder,e);var n=function(e){if(!P.util.isArray(e))return!1;var t=!0;return P.util.forEach(e,function(e){P.util.isArray(e)&&2===e.length&&P.util.isInteger(e[0])&&P.util.isInteger(e[1])||(t=!1)}),t}(e.sizes);n||P.out.output("Invalid sizes have been configured. Should be an two-dimension array of integers within an array","headerBidRequest",e.sizes,e),t.sizes=n?e.sizes:[],t.dealId||delete t.dealId,r.headerBids.push(t)})}),i&&P.out.output("Header bids sent through to Adnuntius","headerBidRequest",r.headerBids),P.request(r)};a?e():n.que.push(e)}))}return function(e,t,i){P.util.isArray(t.adUnits)||P.out.output("Need to supply an array of Adnuntius ad units","headerBid",t);var n=E.pbjs||{};n.que=n.que||[],n.que.push(function(){i&&n.setConfig(i),n.addAdUnits(e),n.requestBids({bidsBackHandler:function(){r(n,t,i)},timeout:2e3})}),o++,E.setTimeout(function(){r(n,t,i,!0)},4e3)}}(),d=function(){var e=V.getAllDatStorageAsObj();return e.browserId=P.util.isNotBlankString(e.browserId)?e.browserId:C.uuid(),e.sessionId=P.util.isNotBlankString(e.sessionId)?e.sessionId:C.uuid(),e.extSync=P.util.isObject(e.extSync)?e.extSync:{},V.writeDatLs(e),e},a=function(e,t,i,n){if(!P.util.isNotBlankString(e))return P.out.output("Need a folder Id","adnDataRequest",e,t,i);var r=C.clone(t||{});r.folderId=e;var s=d();r.browserId=s.browserId,r.sessionId=s.sessionId;var a=P.lib.getAdnDataLocs(r),o=P.util.getNewAjax(i.method,a[i.locKey],P.util.isFunction(n)?function(){n(o)}:null);o.withCredentials=!C.isTestAddress(a[i.locKey]);var u=i.pick.length?JSON.stringify(C.copyArgValues({},r,i.pick)):void 0;o.send(u)};P.getSegments=function(e,i){a(e,i,{method:"GET",pick:["browserId","folderId"],locKey:"user"},function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&P.util.isNotBlankString(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){return P.out.output(e,"ajax.onreadystatechange: catch block send event",t)}P.util.isFunction(i.onResponse)&&i.onResponse(e)}})},P.getBrowserId=function(){return d().browserId},P.visitor=function(e,t){a(e,t,{method:"POST",pick:["profileValues","browserId","sessionId","folderId"],locKey:"visitor"})},P.view=function(e,t){a(e,t,{method:"GET",pick:[],locKey:"page"})},P.externalUserSync=function(e,t){if(!P.util.isNotBlankString(e)||!x.sync[t])return P.out.output("Need a valid folder ID and external system ID to proceed","externalUserSync",e,t);var i=d(),n=x.sync[t].replace("{BROWSER_ID}",encodeURIComponent(i.browserId)).replace("{FOLDER_ID}",encodeURIComponent(e)),r=i.extSync[t];(new Date).getTime();P.util.isInteger(r);var s=T.createElement("img");s.setAttribute("alt",""),s.setAttribute("src",n),s.setAttribute("height","1px"),s.setAttribute("width","1px"),T.body.appendChild(s)},P.sync=function(e,t){if(!P.util.isNotBlankString(t.externalSystemType)||!P.util.isNotBlankString(t.externalSystemUserId))return P.out.output("Need an external system type or external system user id","sync",e,t);a(e,t,{method:"POST",pick:["externalSystemType","externalSystemUserId"],locKey:"sync"})},P.chbRequest=s,P.regScriptServe=function(e,t){var i=T.getElementById("script-"+t);return i&&i.src&&-1<i.src.indexOf("format=js")?(n({widgetId:t,container:"div"}),C.addWidgetIdToProcessAd(e,t)):e},P.request=function(e){n(e);var t=x.methodEnums.ifr;P.util.isArray(e.adUnits)?t=x.methodEnums.composed:P.util.isArray(e.creatives)&&(t=x.methodEnums.preview),i(e,h,t)},P.display=function(e){i(e,t,"style")},P.setFeedbackOptions=function(e){j.setFeedbackOptions(e)}}(),function(){if(!n){var e=C.getScriptOverride();if(e){var t=T.createElement("script");return t.type="text/javascript",t.id=c,t.src=e,T.body.appendChild(t)}}U(),j.registerListeners(),j.setFeedbackOptions();var i=function(){try{for(var t;t=P.calls.shift();)try{t()}catch(e){P.out.output(e,"executeCalls: inside while catch block",t,P.calls)}}catch(e){P.out.output(e,"executeCalls: outside while catch block",P.calls)}};E.setTimeout(i,25),P.calls.push=function(){return Array.prototype.push.apply(this,arguments),E.setTimeout(i,1),this.length}}()}(adn,document,window)}catch(e){adn.out.output(e,"Blanket catch block")}
//# sourceMappingURL=adn.js.map
